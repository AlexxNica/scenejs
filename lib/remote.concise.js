/* Remote is released according to the Creative Commons Attribution-Share Alike 3.0 License. You are free to use, distribute, and modify (as long as you share alike).*/
var Remote=window.Remote||{};Remote.XHR=function(url){if(!url){return;}else{Remote.XHR.url=url;}Remote.XHR.settings={};this.queries={};};Remote.XHR.prototype={callback:function(callback){if(typeof callback==="undefined"){return;}var queryString,queryArray=[],i;if(!this.enableRPCMethod){if(typeof Remote.XHR.settings["method"]==="undefined"){Remote.XHR.settings["method"]="GET";}Remote.XHR.settings["method"]=Remote.XHR.settings["method"].toUpperCase();if((typeof Remote.XHR.settings["response"]==="undefined")||(Remote.XHR.settings["response"].toUpperCase()==="XML")){Remote.XHR.settings["response"]=true;}else if(Remote.XHR.settings["response"].toUpperCase()==="TEXT"){Remote.XHR.settings["response"]=false;}for(i in this.queries){queryArray.push(i+"="+this.queries[i]);}if(/\?/.test(Remote.XHR.url)){queryString="&";}else{queryString=((Remote.XHR.settings["method"]==="GET")&&(queryArray.length!==0))?"?":"";}queryString+=queryArray.join("&");}else{queryString=this.JSONQuery();}var request=new this.prep(),type=(Remote.XHR.settings["method"]==="GET")?"text/xml":"application/x-www-form-urlencoded",data;if(request){if(this.pipeline&&Remote.isBusy){request.onreadystatechange=function(){};request.abort();}if(typeof request.open!=="undefined"){if(Remote.XHR.settings["method"]==="GET"){request.open(Remote.XHR.settings["method"],Remote.XHR.url+queryString,true);}else{request.open(Remote.XHR.settings["method"],Remote.XHR.url,true);request.setRequestHeader("Content-Length",queryString.length);request.setRequestHeader("Connection","close");}request.setRequestHeader("Content-Type",type);request.setRequestHeader("Cache-Control","no-cache");if(this.pipeline){Remote.isBusy=true;}}request.onreadystatechange=function(){if(request.readyState===4){if((request.status===200||request.status===304)||(typeof request.open==="undefined")){if(this.pipeline){Remote.isBusy=false;}Remote.XHR.prototype.onreadystatechange(request,callback);}else if((typeof window.console!=="undefined")&&(typeof console.log!=="undefined")){console.log("Whoops, something weird happened. Error:",request.status);}}};if(typeof request.send!=="undefined"){request.send(queryString);}}},onreadystatechange:function(request,callback){switch(Remote.XHR.type){case"XMLHttpRequest":if(request.overrideMimeType){request.overrideMimeType("text/xml");}if(Remote.XHR.settings["response"]===true){data=request.responseXML;}else{data=request.responseText;}break;case"XMLDataIsland":data=request;break;case"ActiveXObject":if(Remote.XHR.settings["response"]===true){if(request.responseXML){data=request.responseXML;}else{data=new ActiveXObject("Microsoft.XMLDOM");data.loadXML(request.responseText);}}else{data=request.responseText;}break;}if(/\./.test(callback)){var calls=callback.split("."),fire=window[calls[0]];for(var i=1;i<calls.length;i++){fire=fire[calls[i]];}fire(data);}else{window[callback](data);}},prep:function(){var req,xml;if(typeof window.XMLHttpRequest!=="undefined"){try{Remote.XHR.type="XMLHttpRequest";req=new XMLHttpRequest();}catch(e){return false;}}else if((document.createElement)&&(Remote.XHR.settings["method"]!=="POST")&&(Remote.XHR.settings["response"]===true)){Remote.XHR.type="XMLDataIsland";xml=document.createElement("xml");xml.src=Remote.XHR.url;document.body.appendChild(xml);req=xml.XMLDocument;document.body.removeChild(xml);}else if(window.ActiveXObject){Remote.XHR.type="ActiveXObject";try{req=new ActiveXObject("Msxml2.XMLHTTP");}catch(e){try{req=new ActiveXObject("Microsoft.XMLHTTP");}catch(e){req=false;}}}else{req=false;}return req;},setResponse:function(value){if(!Remote.XHR.settings){Remote.XHR.settings={};}Remote.XHR.settings["response"]=value;},setMethod:function(value){if(this.enableRPCMethod){return this.enableRPC.setMethod(e);}else{if(!Remote.XHR.settings){Remote.XHR.settings={};}Remote.XHR.settings["method"]=value;}},setQuery:function(name,value){if(typeof name==="object"){for(var i in name){if(/\s/g.test(name[i])){name[i]=name[i].replace(/\s/g,"+");}this.queries[i]=name[i];}}else{if(/\s/g.test(value)){value=value.replace(/\s/g,"+");}this.queries[name]=value;}},setPipelining:function(e){this.pipeline=e;},enableRPC:function(){this.enableRPCMethod=true;Remote.XHR.settings["method"]="POST";Remote.XHR.settings["response"]=false;this.params=[];this.JSONObject={};this.setParams=function(object){this.JSONObject["params"]=object;};this.setId=function(e){if(!e||e===null){e="null";}this.JSONObject["id"]=e;};this.setMethod=function(e){this.JSONObject["method"]=e;return this.callback(e);};this.JSONQuery=function(){var queryArray=[],objectArray=[],queryString="",i,j;for(i in this.JSONObject){if(typeof this.JSONObject[i]==="number"){queryArray.push("\""+i+"\":"+this.JSONObject[i]);}else if(typeof this.JSONObject[i]==="string"){queryArray.push("\""+i+"\":\""+this.JSONObject[i]+"\"");}else{for(i=0;i<this.JSONObject[i].length;i++){objectArray.push("\""+this.JSONObject[i][i]+"\"");}queryArray.push("\""+i+"\":["+objectArray.join(",")+"]");}}queryString="{"+queryArray.join(",")+"}";return queryString;};},setParams:function(e){return this.enableRPC.setParams(e);},setId:function(e){return this.enableRPC.setId(e);}};Remote.JSON=function(url){if(!url){return;}this.url=url;this.queries={};};Remote.JSON.prototype={callback:function(callback){if(this.pipeline){if(Remote.isBusy){return;}Remote.isBusy=true;}var script=document.getElementById("JSON-Script");if(script){script.parentNode.removeChild(script);}var queryArray=[];for(var i in this.queries){queryArray.push(i+"="+this.queries[i]);}queryArray.push("callback="+callback);var queryString=(/\?/.test(this.url))?"&":"?";queryString+=queryArray.join("&");this.url=this.url+queryString;script=document.createElement("script");script.setAttribute("id","JSON-Script");script.setAttribute("type","text/javascript");script.setAttribute("src",this.url);document.getElementsByTagName("head")[0].appendChild(script);if(this.pipeline){Remote.isBusy=false;}},setQuery:function(name,value){if(typeof name==="object"){for(var i in name){this.queries[i]=name[i];}}else{this.queries[name]=value;}}};Remote.Upload=function(form){if(!form){return;}this.form=form;this.setTarget();};Remote.Upload.prototype={setInput:function(name,value){if(typeof arguments[0]!=="object"){this.createInput(name,value);}else{for(var i in name){this.createInput(i,name[i]);}}},createInput:function(name,value){if(!document.getElementById(name)){var hidden=document.createElement("input");hidden.setAttribute("type","hidden");hidden.setAttribute("name",name);hidden.setAttribute("id",name);hidden.setAttribute("value",value);this.form.appendChild(hidden);}else{document.getElementById(name).setAttribute("value",value);}},setTarget:function(){this.target="Remote-Target";if(!document.getElementById(this.target)){var iframe;if(window.ActiveXObject){iframe=document.createElement("<iframe id=\""+this.target+"\" name=\""+this.target+"\" \/>");iframe.src="javascript:false";}else{iframe=document.createElement("iframe");iframe.setAttribute("id",this.target);iframe.setAttribute("name",this.target);}iframe.style.position="absolute";iframe.style.top="-1000px";iframe.style.left="-1000px";document.getElementsByTagName("body")[0].appendChild(iframe);}},submit:function(){this.form.setAttribute("target",this.target);this.form.submit();}};