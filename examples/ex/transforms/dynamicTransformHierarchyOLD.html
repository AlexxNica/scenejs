<!DOCTYPE html>
<html lang="en">
<head>
    <title>SceneJS V3 Basic Example</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>

<script src="../../../build/latest/scenejs.js"></script>

<script src="../../../build/latest/extras/orbitControl.js"></script>

<script>

// Example of a SceneJS modelling transform hierarchy
//
// - Transforms can be nested in any combination.
// - There is no limit on hierarchy depth.
// - Transform hierarchies are baked into a single modelling matrix for each geometry, so there is no render-time
//   performance penalty for deep hierarchies. They are efficiently re-baked as required when you update their
//   properties (angle, scale factors etc).

var scene = SceneJS.createScene({
    nodes:[
        {
            type:"lookAt",
            eye:{ z:10 },
            nodes:[
                {
                    id:"pitch",
                    type:"rotate",
                    angle:30.0,
                    x:1.0,

                    nodes:[
                        {
                            id:"yaw",
                            type:"rotate",
                            angle:-30.0,
                            y:1.0,
                            nodes:[

                                {
                                    type:"rotate",
                                    y:1,
                                    angle:10,
                                    id:"base",
                                    nodes:[
                                        // Lower arm
                                        {
                                            type:"translate",
                                            x:0, y:2, z:0,
                                            nodes:[
                                                {
                                                    type:"scale",
                                                    x:0.07, y:2.5, z:0.2,
                                                    nodes:[
                                                        {
                                                            type:"material",
                                                            color:{ r:1.0, g:0.4, b:0.4 },
                                                            specularColor:{r:1, g:1, b:1 },
                                                            nodes:[
                                                                {
                                                                    type:"translate",
                                                                    x:-6.0,
                                                                    nodes:[

                                                                        {
                                                                            type:"geometry",
                                                                            source:{
                                                                                type:"box"
                                                                            }
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    type:"translate",
                                                                    x:6.0,
                                                                    nodes:[
                                                                        {
                                                                            type:"geometry",
                                                                            source:{
                                                                                type:"box"
                                                                            }
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },

                                                // Upper arm
                                                {
                                                    type:"translate",
                                                    x:0, y:2, z:0,
                                                    nodes:[
                                                        {
                                                            type:"rotate",
                                                            x:1.0,
                                                            angle:20,
                                                            id:"elbow",
                                                            nodes:[
                                                                {
                                                                    type:"scale",
                                                                    x:0.07, y:3.5, z:0.2,
                                                                    nodes:[
                                                                        {
                                                                            type:"material",
                                                                            color:{ r:1.0, g:0.4, b:0.4 },
                                                                            specularColor:{r:1, g:1, b:1 },
                                                                            nodes:[
                                                                                {
                                                                                    type:"translate",
                                                                                    x:-4.0,
                                                                                    nodes:[

                                                                                        {
                                                                                            type:"geometry",
                                                                                            source:{
                                                                                                type:"box"
                                                                                            }
                                                                                        }
                                                                                    ]
                                                                                },
                                                                                {
                                                                                    type:"translate",
                                                                                    x:4.0,
                                                                                    nodes:[
                                                                                        {
                                                                                            type:"geometry",
                                                                                            source:{
                                                                                                type:"box"
                                                                                            }
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    type:"translate",
                                                                    y:-2.8,
                                                                    nodes:[
                                                                        {
                                                                            type:"rotate",
                                                                            x:1,
                                                                            angle:0,

                                                                            nodes:[
                                                                                {
                                                                                    type:"translate",
                                                                                    y:-2.8,
                                                                                    id:"block",
                                                                                    nodes:[
                                                                                        {
                                                                                            type:"scale",
                                                                                            x:0.2, y:0.7, z:0.7,

                                                                                            nodes:[
                                                                                                {
                                                                                                    type:"material",
                                                                                                    color:{ r:0.2, g:0.2, b:0.2 },
                                                                                                    specularColor:{r:0, g:0, b:0 },
                                                                                                    nodes:[
                                                                                                        {
                                                                                                            type:"geometry",
                                                                                                            source:{
                                                                                                                type:"box"
                                                                                                            }
                                                                                                        }
                                                                                                    ]
                                                                                                }
                                                                                            ]
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ]
});

new SceneJS.OrbitControls(scene);


var base = scene.getNode("base");
var elbow = scene.getNode("elbow");
var block = scene.getNode("block");

var baseAngle = 0;
var elbowAngle = 0;
var blockPos = 0;

scene.on("tick",
        function () {
            base.setAngle(baseAngle);
            elbow.set({ angle:elbowAngle });  // Alternative way to set angles
            block.set({ y:blockPos });

            baseAngle += 0.5;
            elbowAngle += 0.5;
            blockPos += 0.01;
        });

</script>
</body>
</html>