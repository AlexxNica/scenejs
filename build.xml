<project name="" basedir="." default="package">

    <property name="BUILD_MAJOR" value="0"/>
    <property name="BUILD_MINOR" value="7"/>
    <property name="BUILD_ID" value="0"/>

    <property name="LIB_DIR" location="${basedir}/lib"/>

    <property name="SRC_DIR" location="${basedir}/src"/>

    <property name="EXAMPLES_DIR" location="${basedir}/website"/>

    <property name="SCENEJS_JS_NAME" value="scenejs.js"/>

    <property name="SCENEJS_MIN_JS_NAME" value="scenejs.min.js"/>

    <property name="DIST_CONTAINER_DIR" location="${basedir}/dist"/>

    <property name="SCENEJS_NAME" value="scenejs-${BUILD_MAJOR}.${BUILD_MINOR}.${BUILD_ID}"/>

    <property name="EXTRACTED_DIST_DIR" location="${DIST_CONTAINER_DIR}/extracted/${SCENEJS_NAME}"/>


    <path id="yuicompressor.classpath">
        <fileset dir="${LIB_DIR}">
            <include name="**/yuicompressor-2.4.2.jar"/>
            <include name="**/YUIAnt.jar"/>

        </fileset>
    </path>

    <path id="jsdoc.classpath">
        <fileset dir="${LIB_DIR}">
            <include name="**/jsdoctoolkit-ant-task-1.0.2.jar"/>
            <include name="**/js.jar"/>

        </fileset>
    </path>

    <path id="sourcefiles">
        <fileset dir="${basedir}" includes="license.txt"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/core/core.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/exceptions/exceptions.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/core/math.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/core/webgl.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/core/webgl-trace.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/core/data.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/node/node.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/events/eventsModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/errors/errorsModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/time/timeModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/logging/loggingModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/logging/logging.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/logging/loggingToPage.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/memory/memoryModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/name/nameModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/name/name.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/instancing/instancingModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/instancing/symbol.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/instancing/instance.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/processes/processModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/load/loadModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/load/load.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/loadCollada/colladaParserModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/loadCollada/loadCollada.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/scene/sceneModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/scene/scene.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/shading/shadingModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/renderer/rendererModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/renderer/renderer.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/geometryModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/geometry.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/teapot.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/cube.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/sphere.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/text/vectorTextModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/geometry/text/text.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/modelTransformModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/rotate.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/translate.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/scale.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/modelMatrix.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/projectionModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/perspective.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/ortho.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/frustum.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/viewTransformModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/lookAt.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/viewMatrix.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/stationary.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/lighting/lightingModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/lighting/lightSource.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/lighting/lights.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/material/materialModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/material/material.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/interpolation/scalarInterpolator.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/withData/withData.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/generation/generator.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/boundary/viewFrustumModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/boundary/viewLocalityModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/boundary/boundingBox.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/boundary/locality.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/texture/textureModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/texture/textureLayer.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/texture/texture.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/fog/fogModule.js"/>
        <fileset dir="${SRC_DIR}" includes="scenejs/fog/fog.js"/>
    </path>

    <target name="all" depends="archive"/>

    <target name="docs" description="Create JS Docs">
        <taskdef name="jsdoctoolkit" classname="uk.co.darrenhurley.ant.tasks.JsDocToolkit">
            <classpath>
                <path refid="jsdoc.classpath"/>
            </classpath>
        </taskdef>

        <jsdoctoolkit
                jsdochome="${basedir}/lib/jsdoc-toolkit/"
                template="jsdoc"
                outputdir="${basedir}/docs/">
            <fileset dir="${SRC_DIR}" includes="scenejs/core/core.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/exceptions/exceptions.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/core/data.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/node/node.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/logging/logging.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/logging/loggingToPage.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/name/name.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/instancing/instancingModule.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/instancing/symbol.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/instancing/instance.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/load/load.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/loadCollada/loadCollada.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/scene/scene.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/renderer/renderer.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/geometry.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/teapot.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/cube.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/sphere.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/text/text.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/rotate.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/translate.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/scale.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/modelMatrix.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/perspective.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/ortho.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/frustum.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/lookAt.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/viewMatrix.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/stationary.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/lighting/lightSource.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/lighting/lights.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/material/material.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/interpolation/scalarInterpolator.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/withData/withData.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/generation/generator.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/boundary/boundingBox.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/boundary/locality.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/texture/textureLayer.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/texture/texture.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/fog/fog.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/events/eventsModule.js"/>
        </jsdoctoolkit>
    </target>


    <target name="archive" depends="package" description="Create archives of downloads">

        <tar destfile="${DIST_CONTAINER_DIR}/${SCENEJS_NAME}.tar.gz"
             basedir="${DIST_CONTAINER_DIR}/extracted"
             compression="gzip"/>

        <zip destfile="${DIST_CONTAINER_DIR}/${SCENEJS_NAME}.zip" basedir="${DIST_CONTAINER_DIR}/extracted"/>

        <!-- Write version data to website -->
        <!--<echo file="website/data/version.js" append="false">{ version: "${BUILD_MAJOR}.${BUILD_MINOR}.${BUILD_ID}" }-->
        <!--</echo>-->
    </target>

    <!-- Create compressed javascript lib -->

    <target name="package" depends="assemble-lib" description="Create compressed SceneJS lib">
        <taskdef name="yuicompress" classname="com.yahoo.platform.yui.compressor.YUICompressTask">
            <classpath>
                <path refid="yuicompressor.classpath"/>
            </classpath>
        </taskdef>
        <yuicompress linebreak="300" warn="false" munge="no" preserveallsemicolons="true"
                     outputfolder="${EXTRACTED_DIST_DIR}">
            <fileset dir="${EXTRACTED_DIST_DIR}/lib/">
                <include name="**/*.js"/>
            </fileset>
        </yuicompress>
        <move file="${EXTRACTED_DIST_DIR}/${SCENEJS_JS_NAME}"
              tofile="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_MIN_JS_NAME}"/>
    </target>

    <!-- Assemble javascript lib -->

    <target name="assemble-lib" depends="create-dist-directories" description="Create uncompressed SceneJS lib">

        <echo message="Building ${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME}"/>

        <concat fixlastline="yes" destfile="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME}">
            <path refid="sourcefiles"/>
        </concat>

        <copy file="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME}"
              tofile="${EXAMPLES_DIR}/lib/scenejs/${SCENEJS_JS_NAME}"/>

        <echo message="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME} built."/>
    </target>


    <!-- Build distribution directories -->

    <target name="create-dist-directories" description="Create dist directories">


        <delete includeemptydirs="true">
            <fileset dir="${DIST_CONTAINER_DIR}" includes="**" defaultexcludes="false"/>
        </delete>

        <mkdir dir="${EXTRACTED_DIST_DIR}"/>
        <mkdir dir="${EXTRACTED_DIST_DIR}/lib"/>
    </target>

</project>
