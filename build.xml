<!--
	Builds SceneJS

	Guava3D home:	http://www.scenejs.com
	Author: 	Lindsay S. Kay, Jan 2, 2010
-->
<project name="" basedir="." default="package">

    <property name="BUILD_MAJOR" value="0"/>
    <property name="BUILD_MINOR" value="4"/>
    <property name="BUILD_ID" value="0"/>

    <property name="LIB_DIR" location="${basedir}/lib"/>

    <property name="SRC_DIR" location="${basedir}/src"/>

    <property name="SCENEJS_JS_NAME" value="scenejs.js"/>

    <property name="SCENEJS_MIN_JS_NAME" value="scenejs.min.js"/>

    <property name="DIST_CONTAINER_DIR" location="${basedir}/dist"/>

    <property name="SCENEJS_NAME" value="scenejs-${BUILD_MAJOR}.${BUILD_MINOR}.${BUILD_ID}"/>

    <property name="EXTRACTED_DIST_DIR" location="${DIST_CONTAINER_DIR}/extracted/${SCENEJS_NAME}"/>


    <path id="yuicompressor.classpath">
        <fileset dir="${LIB_DIR}">
            <include name="**/yuicompressor-2.4.2.jar"/>
            <include name="**/YUIAnt.jar"/>

        </fileset>
    </path>


    <target name="all" depends="archive"/>

    <target name="archive" depends="package" description="Create archives of downloads">

        <tar destfile="${DIST_CONTAINER_DIR}/${SCENEJS_NAME}.tar.gz"
             basedir="${DIST_CONTAINER_DIR}/extracted"
             compression="gzip"/>

        <zip destfile="${DIST_CONTAINER_DIR}/${SCENEJS_NAME}.zip" basedir="${DIST_CONTAINER_DIR}/extracted"/>
    </target>

    <!-- Create compressed javascript lib -->

    <target name="package" depends="assemble-lib" description="Create compressed SceneJS lib">
        <taskdef name="yuicompress" classname="com.yahoo.platform.yui.compressor.YUICompressTask">
            <classpath>
                <path refid="yuicompressor.classpath"/>
            </classpath>
        </taskdef>
        <yuicompress linebreak="300" warn="false" munge="no" preserveallsemicolons="true"
                     outputfolder="${EXTRACTED_DIST_DIR}">
            <fileset dir="${EXTRACTED_DIST_DIR}/lib/">
                <include name="**/*.js"/>
            </fileset>
        </yuicompress>
        <move file="${EXTRACTED_DIST_DIR}/${SCENEJS_JS_NAME}"
              tofile="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_MIN_JS_NAME}"/>
    </target>


    <!-- Assemble javascript lib -->

    <target name="assemble-lib" depends="create-dist-directories" description="Create uncompressed SceneJS lib">

        <echo message="Building ${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME}"/>

        <concat fixlastline="yes" destfile="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME}">
            <fileset dir="${basedir}" includes="license.txt"/>


            <!-- Core -->

            <fileset dir="${SRC_DIR}" includes="scenejs/core/core.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/core/math.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/core/node.js"/>

            <!-- Exceptions -->

            <fileset dir="${SRC_DIR}" includes="scenejs/exceptions/exceptions.js"/>

            <!-- Scene -->

            <fileset dir="${SRC_DIR}" includes="scenejs/scene/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/scene/scene.js"/>

            <!-- Renderer -->

            <fileset dir="${SRC_DIR}" includes="scenejs/renderer/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/renderer/renderer.js"/>

            <!-- Shading -->

            <fileset dir="${SRC_DIR}" includes="scenejs/shading/backendBase.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/shading/shader.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/shading/simple/simpleBackend.js"/>

            <!-- Geometry -->

            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/geometry.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/teapot.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/geometry/objects/cube.js"/>

            <!-- Modelling transforms -->

            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/rotate.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/translate.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/model/scale.js"/>

            <!-- Projection transforms -->

            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/perspective.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/ortho.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/projection/frustum.js"/>

            <!-- Viewing transforms -->

            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/transformation/view/lookat.js"/>

            <!-- Lighting -->

            <fileset dir="${SRC_DIR}" includes="scenejs/lighting/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/lighting/lights.js"/>

            <!-- Material -->

            <fileset dir="${SRC_DIR}" includes="scenejs/appearance/material.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/appearance/backend.js"/>

            <!-- Layers -->

            <fileset dir="${SRC_DIR}" includes="scenejs/layering/backend.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/layering/layer.js"/>

            <!-- Interpolation -->

            <fileset dir="${SRC_DIR}" includes="scenejs/animation/scalarInterpolator.js"/>

            <!-- Scope -->

            <fileset dir="${SRC_DIR}" includes="scenejs/scope/scope.js"/>

            <!-- Generation -->

            <fileset dir="${SRC_DIR}" includes="scenejs/generation/generator.js"/>

            <!-- Assets -->

            <fileset dir="${SRC_DIR}" includes="scenejs/asset/asset.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/asset/backendBase.js"/>
            <fileset dir="${SRC_DIR}" includes="scenejs/asset/js/jsBackend.js"/>

        </concat>
        <echo message="${EXTRACTED_DIST_DIR}/lib/${SCENEJS_JS_NAME} built."/>
    </target>


    <!-- Build distribution directories -->

    <target name="create-dist-directories" description="Create dist directories">

        <delete includeemptydirs="true">
            <fileset dir="${DIST_CONTAINER_DIR}" includes="**" defaultexcludes="false"/>
        </delete>

        <mkdir dir="${EXTRACTED_DIST_DIR}"/>
        <mkdir dir="${EXTRACTED_DIST_DIR}/lib"/>
        <mkdir dir="${EXTRACTED_DIST_DIR}/examples"/>

        <!-- Examples -->

        <!-- Basic -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/basic"/>

        <!-- Teapot -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/basic/teapot"/>
        <copy file="${SRC_DIR}/examples/basic/teapot/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/basic/teapot/index.html"/>
        <copy file="src/examples/basic/teapot/teapot.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/basic/teapot/teapot.js"/>

        <!-- Animation -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/animation"/>

        <!-- Teapots flythrough -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/animation/teapot-cluster-flythrough"/>
        <copy file="${SRC_DIR}/examples/animation/teapot-cluster-flythrough/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/animation/teapot-cluster-flythrough/index.html"/>
        <copy file="src/examples/animation/teapot-cluster-flythrough/teapot-cluster-flythrough.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/animation/teapot-cluster-flythrough/teapot-cluster-flythrough.js"/>

        <!-- Generation -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/generation"/>

        <!-- Multiple teapots -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/generation/multiple-teapots"/>
        <copy file="${SRC_DIR}/examples/generation/multiple-teapots/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/multiple-teapots/index.html"/>
        <copy file="src/examples/generation/multiple-teapots/multiple-teapots.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/multiple-teapots/multiple-teapots.js"/>

        <!-- Multiple viewports -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/generation/multiple-viewports"/>
        <copy file="${SRC_DIR}/examples/generation/multiple-viewports/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/multiple-viewports/index.html"/>
        <copy file="src/examples/generation/multiple-viewports/multiple-viewports.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/multiple-viewports/multiple-viewports.js"/>

        <!-- Spiral staircase -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/generation/spiral-staircase"/>
        <copy file="${SRC_DIR}/examples/generation/spiral-staircase/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/spiral-staircase/index.html"/>
        <copy file="src/examples/generation/spiral-staircase/spiral-staircase.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/spiral-staircase/spiral-staircase.js"/>

        <copy file="licenses/MIT_LICENSE.txt" tofile="${EXTRACTED_DIST_DIR}/license.txt"/>
        <copy file="${basedir}/README.txt" tofile="${EXTRACTED_DIST_DIR}/README.txt"/>

        <!-- Multiple canvases -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/generation/multiple-canvases"/>
        <copy file="${SRC_DIR}/examples/generation/multiple-canvases/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/multiple-canvases/index.html"/>
        <copy file="src/examples/generation/multiple-canvases/multiple-canvases.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/generation/multiple-canvases/multiple-canvases.js"/>

        <!-- Scalar inpterpolator -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/animation/interpolated-rotation"/>
        <copy file="${SRC_DIR}/examples/animation/interpolated-rotation/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/animation/interpolated-rotation/index.html"/>
        <copy file="src/examples/animation/interpolated-rotation/interpolated-rotation.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/animation/interpolated-rotation/interpolated-rotation.js"/>

        <!-- Assets -->

        <mkdir dir="${EXTRACTED_DIST_DIR}/examples/assets/js-teapot-asset"/>
        <copy file="${SRC_DIR}/examples/assets/js-teapot-asset/index.html"
              tofile="${EXTRACTED_DIST_DIR}/examples/assets/js-teapot-asset/index.html"/>
        <copy file="src/examples/assets/js-teapot-asset/js-teapot-asset-demo.js"
              tofile="${EXTRACTED_DIST_DIR}/examples/assets/js-teapot-asset/js-teapot-asset-demo.js"/>

        <!-- License and readme -->

        <copy file="licenses/MIT_LICENSE.txt" tofile="${EXTRACTED_DIST_DIR}/license.txt"/>
        <copy file="${basedir}/README.txt" tofile="${EXTRACTED_DIST_DIR}/README.txt"/>
    </target>

</project>
