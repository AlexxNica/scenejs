<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>SceneJS Test</title>

    <link rel="stylesheet" type="text/css" href="css/superfish.css" media="screen">
    <link href="css/style.css" rel="stylesheet" type="text/css"/>

    <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>-->
    <script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="js/jquery.jtemplates.js"></script>
    <script type="text/javascript" src="js/hoverIntent.js"></script>
    <script type="text/javascript" src="js/superfish.js"></script>
    <script type="text/html" id="menus_template">
        {#template MAIN}
        <ul class="sf-menu">
            <li class="current">
                <a href="#a">File</a>
                <ul>
                    <li>
                        <a href="#aa">Download</a>
                    </li>
                    <li>
                        <a href="#ab">Credits</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="#">View</a>
                <ul>
                    <li class="current">
                        <a href="#ab">Cameras</a>
                        <ul>
                            <li><a href="javascript:activateCamera('__scenejs_default')">Default</a></li>
                            {#foreach $T.cameras as camera}
                            <li><a href="javascript:activateCamera('{$T.camera.id}')">{$T.camera.id}</a></li>
                            {#/for}
                        </ul>
                    </li>
                    <li>
                        <a href="#">Lights</a>
                        <ul>
                            <li><a href="#">light1</a></li>
                            <li><a href="#">light2</a></li>

                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        {#/template MAIN}
    </script>


</head>
<body>
<div id="container">
    <div id="content">
        <div id="view">
            <canvas id="theCanvas" width="790px" height="490px" background="#000000">
                <p>This example requires a browser that supports the
                    <a href="http://www.w3.org/html/wg/html5/">HTML5</a>
                    &lt;canvas&gt; feature.</p>
            </canvas>
        </div>
    </div>
    <div id="header">
        <div id="title">
        </div>
        <div id="menus">

        </div>
    </div>

</div>


<script type="application/x-javascript" src="../../../scenejs/core/core.js"></script>
<script type="application/x-javascript" src="../../../scenejs/exceptions/exceptions.js"></script>
<script type="application/x-javascript" src="../../../scenejs/core/math.js"></script>
<script type="application/x-javascript" src="../../../scenejs/core/webgl.js"></script>
<script type="application/x-javascript" src="../../../scenejs/core/webgl-trace.js"></script>
<script type="application/x-javascript" src="../../../scenejs/core/data.js"></script>
<script type="application/x-javascript" src="../../../scenejs/node/node.js"></script>
<script type="application/x-javascript" src="../../../scenejs/events/eventsModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/errors/errorsModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/time/timeModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/logging/loggingModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/logging/logging.js"></script>
<script type="application/x-javascript" src="../../../scenejs/logging/loggingToPage.js"></script>
<script type="application/x-javascript" src="../../../scenejs/memory/memoryModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/name/nameModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/name/name.js"></script>
<script type="application/x-javascript" src="../../../scenejs/instancing/instancingModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/instancing/symbol.js"></script>
<script type="application/x-javascript" src="../../../scenejs/instancing/instance.js"></script>
<script type="application/x-javascript" src="../../../scenejs/selector/selector.js"></script>
<script type="application/x-javascript" src="../../../scenejs/processes/processModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/load/loadModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/load/load.js"></script>
<script type="application/x-javascript" src="../../../scenejs/loadCollada/colladaParserModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/loadCollada/loadCollada.js"></script>
<script type="application/x-javascript" src="../../../scenejs/scene/sceneModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/scene/scene.js"></script>
<script type="application/x-javascript" src="../../../scenejs/shading/shadingModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/renderer/rendererModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/renderer/renderer.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/geometryModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/geometry.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/objects/teapot.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/objects/cube.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/objects/sphere.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/text/vectorTextModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/geometry/text/text.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/model/modelTransformModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/model/rotate.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/model/translate.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/model/scale.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/model/modelMatrix.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/projection/projectionModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/projection/perspective.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/projection/ortho.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/projection/frustum.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/view/viewTransformModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/view/lookAt.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/view/viewMatrix.js"></script>
<script type="application/x-javascript" src="../../../scenejs/transformation/view/stationary.js"></script>
<script type="application/x-javascript" src="../../../scenejs/lighting/lightingModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/lighting/lightSource.js"></script>
<script type="application/x-javascript" src="../../../scenejs/lighting/lights.js"></script>
<script type="application/x-javascript" src="../../../scenejs/material/materialModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/material/material.js"></script>
<script type="application/x-javascript" src="../../../scenejs/interpolation/scalarInterpolator.js"></script>
<script type="application/x-javascript" src="../../../scenejs/withData/withData.js"></script>
<script type="application/x-javascript" src="../../../scenejs/generation/generator.js"></script>
<script type="application/x-javascript" src="../../../scenejs/boundary/viewFrustumModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/boundary/viewLocalityModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/boundary/boundingBox.js"></script>
<script type="application/x-javascript" src="../../../scenejs/boundary/locality.js"></script>
<script type="application/x-javascript" src="../../../scenejs/texture/textureModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/texture/textureLayer.js"></script>
<script type="application/x-javascript" src="../../../scenejs/texture/texture.js"></script>
<script type="application/x-javascript" src="../../../scenejs/fog/fogModule.js"></script>
<script type="application/x-javascript" src="../../../scenejs/fog/fog.js"></script>


<script>
    var scene;
    var collada;
    var metadata;
    var menuInitialised = false;
    var sceneRenderingParams = {};

    function initScene(url) {
        if (scene) {
            scene.destroy();
        }
        collada = new SceneJS.LoadCollada({
            uri: url,
            loadCameras: true,
            loadLights: true,
            showBoundingBoxes: false // Set this true - see what happens!
        });
        scene = new SceneJS.Scene({
            canvasId: 'theCanvas',
            proxy:"http://scenejs.org/cgi-bin/jsonp_proxy.pl"
        },
                new SceneJS.Perspective({
                    fovy : 65.0, aspect : 1.0, near : 0.40, far : 300.0
                },
                        new SceneJS.LookAt({
                            eye : { x: -1.0, y: 0.0, z: -15 },
                            look : { x: -1.0, y: 0, z: 0 },
                            up : { y: 1.0 }
                        },
//                                new SceneJS.Lights({
//                                    sources: [
//                                        {
//                                            type:                   "dir",
//                                            color:                  { r: 1.0, g: 1.0, b: 1.0 },
//                                            dir:                    { x: 1.0, y: -1.0, z: 1.0 },
//                                            diffuse:                true,
//                                            specular:               true
//                                        },
//                                        {
//                                            type:                   "dir",
//                                            color:                  { r: 1.0, g: 1.0, b: 1.0 },
//                                            dir:                    { x: -1.0, y: -1.0, z: -3.0 },
//                                            diffuse:                true,
//                                            specular:               true
//                                        }
//                                    ]},
                                        collada)
                                //)
                        )
                );
        var pInterval;
        window.render = function() {
            scene.render(sceneRenderingParams);
        };
        SceneJS.addListener("error", function(e) {
            alert(e.exception.message);
            window.clearInterval(pInterval);
        });
        SceneJS.addListener("reset", function() {
            window.clearInterval(pInterval);
        });
        pInterval = setInterval("window.render()", 10);
    }

    /**
     * Initialise user interface - query scene graph and populate menus
     */
    function initUI() {

        /* As soon as Collada found to be loaded after scene traversal,
         * if pull-down menus not created yet, then create them from the
         * Collada metadata
         */
        SceneJS.addListener(
                "scene-rendered", // IE. a scene graph traversal has completed
                function() {
                    if (!menuInitialised) {
                        metadata = collada.getMetadata();
                        if (metadata) {

                            /* Create menu content in DOM
                             */
                            $("#menus").setTemplate($("#menus_template").html());
                            $("#menus").processTemplate(metadata);

                            /* Generate menu widget
                             */
                            $('ul.sf-menu').superfish({
                                onBeforeShow: function() {
                                    $('ul.sf-menu').css({top: $(this).parent().offset().top - $(this).height() });
                                },
                                delay:       1000,                            // one second delay on mouseout
                                animation:   {opacity:'show',height:'show'},
                                speed:       'fast',
                                autoArrows:  true,
                                dropShadows: true
                            });

                            menuInitialised = true; // true until we load a different Collada file
                        }
                    }
                });
    }

    function activateCamera(cameraId) {
        sceneRenderingParams.activeCamera = cameraId;
    }

    $(document).ready(function() {
        initScene("http://www.scenejs.org/library/v0.7/assets/examples/seymourplane_triangulate/seymourplane_triangulate.dae");
        initUI();
    });
</script>

</body>
</html>